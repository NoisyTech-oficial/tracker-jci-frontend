<div class="container">
  <app-header [info]="header"></app-header>

  <button class="back-button" type="button" (click)="voltar()">
    ← Voltar
  </button>

  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-card">
      <p class="subtitle">Aguarde! <br> Estamos obtendo informações...</p>
    </div>
  </div>

  <ng-container *ngIf="!isLoading">
    <ng-container *ngIf="fieldsLead.length || processDetails; else emptyState">
      <div class="row">
        <div class="tabs">
          <button
            class="tab"
            [class.active]="activeTab === 'detalhes'"
            (click)="selectTab('detalhes')"
          >
            Detalhes
          </button>
          <button
            class="tab"
            [class.active]="activeTab === 'processo'"
            (click)="selectTab('processo')"
          >
            Processo
          </button>
        </div>
      </div>

      <div class="row" *ngIf="activeTab === 'detalhes' && fieldsLead.length">
        <label class="title-section">Informações do Lead</label>
        <table class="details-table">
          <tbody>
            <tr *ngFor="let field of fieldsLead">
              <th>{{ field.label }}</th>
              <td>{{ field.value || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="row" *ngIf="activeTab === 'processo'">
        <div class="tab-content">
          <div class="process-loading" *ngIf="processLoading">
            Carregando informações do processo...
          </div>

          <div class="process-error" *ngIf="processError">
            {{ processError }}
          </div>

          <ng-container *ngIf="!processLoading && !processError">
            <div *ngIf="processDetails; else emptyProcess">
              <section class="process-section documents-section">
                <div class="documents-header">
                  <h3 class="section-title">Documentos do Processo</h3>
                  <ng-container *ngIf="documentButtonState as docButton">
                    <ng-container *ngIf="docButton.visible">
                      <button
                        *ngIf="docButton.action === 'request'"
                        type="button"
                        class="documents-button"
                        [ngClass]="docButton.styleClass"
                        (click)="requestDocuments()"
                        [disabled]="docButton.disabled">
                        {{ docButton.label }}
                      </button>

                      <button
                        *ngIf="docButton.action === 'disabled'"
                        type="button"
                        class="documents-button"
                        [ngClass]="docButton.styleClass"
                        disabled>
                        {{ docButton.label }}
                      </button>

                      <button
                        *ngIf="docButton.action === 'open'"
                        type="button"
                        class="documents-button"
                        [ngClass]="docButton.styleClass"
                        (click)="openDocument(docButton.url)">
                        {{ docButton.label }}
                      </button>
                    </ng-container>
                  </ng-container>
                </div>
              </section>

              <section class="process-section">
                <h2 class="section-title">Capa do Processo</h2>
                <div class="process-cover">
                  <div class="cover-item">
                    <span class="label">Classe:</span>
                    <span class="value">{{ processDetails.processo_classe || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Assunto:</span>
                    <span class="value">{{ processDetails.processo_assunto || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Distribuição:</span>
                    <span class="value">{{ formatDate(processDetails.processo_distribuicao) || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Foro:</span>
                    <span class="value">{{ processDetails.processo_foro || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Vara:</span>
                    <span class="value">{{ processDetails.processo_vara || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Juiz:</span>
                    <span class="value">{{ processDetails.processo_juiz || '-' }}</span>
                  </div>
                  <div class="cover-item">
                    <span class="label">Valor da Ação:</span>
                    <span class="value">{{ formatCurrency(processDetails.processo_valor_acao) || '-' }}</span>
                  </div>
                </div>
              </section>

              <section class="process-section">
                <h3 class="section-title">Partes do Processo</h3>
                <div class="process-parties">
                  <div class="party-item">
                    <span class="label">Requerente:</span>
                    <span class="value">{{ processDetails.processo_requerente || '-' }}</span>
                  </div>
                  <div class="party-item">
                    <span class="label">Advogado do Requerente:</span>
                    <span class="value">{{ processDetails.processo_advogado_requerente || '-' }}</span>
                  </div>
                  <div class="party-item">
                    <span class="label">Banco:</span>
                    <span class="value">{{ processDetails.banco || '-' }}</span>
                  </div>
                </div>
              </section>

              <section class="process-section">
                <h3 class="section-title">Movimentações</h3>
                <div class="process-movements" *ngIf="movimentacoes.length; else emptyMovements">
                  <div class="movement-row" *ngFor="let movimento of movimentacoes">
                    <span class="movement-date">{{ formatMovementDate(movimento.data) }}</span>
                    <span class="movement-description">{{ movimento.descricao || movimento.titulo || '-' }}</span>
                  </div>
                </div>
              </section>
            </div>
            <ng-template #emptyProcess>
              <div class="empty-tab">Nenhum dado de processo disponível.</div>
            </ng-template>
            <ng-template #emptyMovements>
              <div class="empty-tab">Nenhuma movimentação disponível.</div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </ng-container>

  <ng-template #emptyState>
    <div class="empty-state">Nenhum detalhe disponível.</div>
  </ng-template>
</div>
