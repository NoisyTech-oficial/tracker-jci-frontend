<div class="dash-wrapper" [class.loading]="isLoading()">
    <!-- Header -->
    <header class="dash-header card">
      <div class="header-text">
        <h1>Processos recebidos por dia</h1>
        <p class="muted">Últimos {{ headerSubtitle }}</p>
      </div>
    </header>
  
    <!-- Filtros -->
    <section class="filters card">
      <div class="preset-group" role="group" aria-label="Filtros rápidos de período">
        <button class="btn pill" [class.active]="mode() === 'preset' && rangePreset === 7"  (click)="setPreset(7)">7 dias</button>
        <button class="btn pill" [class.active]="mode() === 'preset' && rangePreset === 15" (click)="setPreset(15)">15 dias</button>
        <button class="btn pill" [class.active]="mode() === 'preset' && rangePreset === 30" (click)="setPreset(30)">30 dias</button>
      </div>
  
      <div class="custom-range">
        <label>Período:</label>
        <input type="date" [(ngModel)]="startDate" aria-label="Data inicial" />
        <span class="dash">—</span>
        <input type="date" [(ngModel)]="endDate" aria-label="Data final" />
        <button class="btn apply" (click)="applyCustom()">Aplicar</button>
        <button class="btn export" (click)="exportCsv()">Exportar CSV</button>
      </div>
    </section>
  
    <!-- KPIs -->
    <section class="kpis">
      <div class="kpi card kpi-today">
        <span class="kpi-label">
          TOTAIS HOJE
          <button class="info" (click)="toggleTodayInfo()" aria-label="Mais informações">i</button>
        </span>
        <span class="kpi-value">{{ todayTotal }}</span>
  
        <div class="kpi-tooltip" *ngIf="showTodayInfo">
          <p>Este número é atualizado ao longo do dia.</p>
          <p class="muted">Última atualização: {{ lastUpdate }}</p>
          <button class="close" (click)="toggleTodayInfo()">OK</button>
        </div>
      </div>
  
      <div class="kpi card">
        <span class="kpi-label">MÉDIA DIÁRIA</span>
        <span class="kpi-value">{{ kpis.media }}</span>
      </div>
  
      <div class="kpi card">
        <span class="kpi-label">TOTAL NO PERÍODO</span>
        <span class="kpi-value">{{ kpis.total }}</span>
      </div>
    </section>
  
    <!-- Gráfico -->
    <section class="chart card" aria-label="Gráfico de distribuição diária">
      <div class="chart-header">
        <h3>Distribuição diária</h3>
      </div>
  
      <div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>
  
      <div class="skeleton" *ngIf="isLoading()">
        <div class="row" *ngFor="let _ of skeletonRows"></div>
      </div>
  
      <div class="bar-chart"
      *ngIf="!isLoading() && chartData?.length"
      [style.--n]="chartData?.length || 0"
      [style.--gap]="'12px'"
      [style.--h]="'320px'">
  
   <div class="y-axis" aria-hidden="true">
     <span *ngFor="let t of yTicks">{{ t }}</span>
   </div>
  
   <div class="bars"
        [class.dense]="(chartData?.length || 0) > 30">
  
     <div class="bar"
          *ngFor="let d of chartData; trackBy: trackByDate"
          [class.zero]="!d.value"
          [attr.title]="d.date + ': ' + d.value">
  
       <div class="fill" [style.height.%]="barHeight(d.value)">
         <span class="val" [class.inside]="valueInside(d.value)">{{ d.value }}</span>
       </div>
       <span class="x-label">{{ dLabel(d.date) }}</span>
     </div>
  
   </div>
  </div>
  
    </section>
  </div>